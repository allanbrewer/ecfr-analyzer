{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- Main Stats Card -->
    <div class="col-12 mb-4">
        <div class="card shadow-sm main-card" id="main-stats-card">
            <h2>eCFR Analysis Dashboard</h2>
            <div class="main-card-stats">
                <div class="main-stat">
                    <div class="main-stat-value">{{ "{:,}".format(summary.total_word_count|default(0)) }}</div>
                    <div class="main-stat-label">Total Words</div>
                </div>
                <div class="main-stat">
                    <div class="main-stat-value">{{ "{:,}".format(summary.total_corrections|default(0)) }}</div>
                    <div class="main-stat-label">Total Corrections</div>
                </div>
                <div class="main-stat">
                    <div class="main-stat-value">{{ summary.total_parent_agencies|default(0) }}</div>
                    <div class="main-stat-label">Parent Agencies</div>
                </div>
                <div class="main-stat">
                    <div class="main-stat-value">{{ summary.total_child_agencies|default(0) }}</div>
                    <div class="main-stat-label">Child Agencies</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Agency Cards Section -->
    <div class="col-12 mb-4">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">Agency Analysis</h5>
            </div>
            <div class="card-body">
                <div id="agency-cards-container">
                    <!-- Will be populated by JavaScript -->
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Loading agency data...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Agencies by Word Count -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">Top Agencies by Word Count</h5>
                </div>
                <div class="card-body">
                    <div id="word-count-chart" style="height: 300px;">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
                <div class="card-footer bg-light">
                    <a href="agency.html" class="btn btn-sm btn-outline-primary">See Full Agency Analysis</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Corrections Chart -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">Corrections by Agency</h5>
            </div>
            <div class="card-body">
                <div id="corrections-chart" style="height: 300px;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            <div class="card-footer bg-light">
                <a href="historical.html" class="btn btn-sm btn-outline-primary">View Corrections Data</a>
            </div>
        </div>
    </div>

    <!-- Keyword Analysis Overview -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">Keyword Analysis Overview (DEI)</h5>
            </div>
            <div class="card-body">
                <div id="keyword-overview-chart" style="height: 300px;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            <div class="card-footer bg-light">
                <button class="btn btn-sm btn-outline-primary" disabled>Detailed Analysis Coming Soon</button>
            </div>
        </div>
    </div>

    <!-- Bureaucratic Complexity -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">Bureaucratic Complexity</h5>
            </div>
            <div class="card-body">
                <div id="bureaucratic-complexity-chart" style="height: 300px;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            <div class="card-footer bg-light">
                <button class="btn btn-sm btn-outline-primary" disabled>Complexity Metrics Coming Soon</button>
            </div>
        </div>
    </div>

    <!-- What's New Section -->
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">Recent Regulatory Changes</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Agency</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody id="recent-changes-table">
                            <!-- Will be populated by JavaScript -->
                            <tr>
                                <td colspan="5" class="text-center">Loading recent changes...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer bg-light">
                <a href="historical.html" class="btn btn-sm btn-outline-primary">View All Changes</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
<script src="static/js/charts.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize dashboard charts
        initDashboardCharts();

        // Load agency dropdown for quick search
        loadAgencyDropdown('search-agency');

        // Load recent changes data
        loadRecentChanges();
    });
</script>
{% endblock %}